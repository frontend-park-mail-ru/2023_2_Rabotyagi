version: '3.8'

services:
    postgres:
        image: postgres:16.0-alpine3.18
        restart: always
        env_file:
            - .env/.env.postgres
        # ports:
        #     - 5432:5432
        volumes:
            - postgres:/var/lib/postgresql/data

    pgadmin:
        image: dpage/pgadmin4:7.8
        env_file:
            - .env/.env.pgadmin
        ports:
            - 15432:80
        volumes:
            - pgadmin:/var/lib/pgadmin
        depends_on:
            - postgres

    backend-fs:
        image: ghcr.io/go-park-mail-ru/2023_2_rabotyagi:fs-latest-dev
        restart: always
        env_file:
            - .env/.env.fs
        # ports:
        #     - 8081:8081
        #      - 8011:8011
        depends_on:
            - postgres
        volumes:
            - imgs:/var/file_service/static/img
            - log-fs:/var/log/backend

    backend-auth:
        image: ghcr.io/go-park-mail-ru/2023_2_rabotyagi:auth-latest-dev
        restart: always
        env_file:
            - .env/.env.auth
        expose:
            - 8012
            - 8011
        # ports:
        #     - '8012'
        depends_on:
            - postgres
        volumes:
            - log-auth:/var/log/backend

    backend:
        image: ghcr.io/go-park-mail-ru/2023_2_rabotyagi:main-latest-dev
        restart: always
        env_file:
            - .env/.env.main
        ports:
            - 8080:8080
        depends_on:
            - postgres
            - backend-fs
            - backend-auth
        volumes:
            - log:/var/log/backend

volumes:
    postgres:
    pgadmin:
    imgs:
    log:
    log-fs:
    log-auth:
